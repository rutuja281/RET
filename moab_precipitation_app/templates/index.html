<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moab Precipitation Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container mt-5">
        <div class="header mb-4">
            <h1 class="display-4">Precipitation Data Analysis</h1>
            <p class="lead">Analyze precipitation data with separate rain and snow visualizations</p>
        </div>
        
        <!-- File Upload Section -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">1. Upload CSV File</h5>
            </div>
            <div class="card-body">
                    <div class="mb-3">
                        <label for="fileInput" class="form-label">Select CSV file:</label>
                        <input type="file" id="fileInput" accept=".csv" class="form-control">
                        <div class="form-text">Upload MeteoBlue History+ or SynopticX CSV file (files are stored in database)</div>
                    </div>
                <button onclick="uploadFile()" class="btn btn-primary">
                    <span id="uploadSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                    Upload File
                </button>
                <div id="uploadStatus" class="mt-3"></div>
            </div>
        </div>
        
        <!-- File Selection -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">2. Select Data File</h5>
            </div>
            <div class="card-body">
                <select id="fileSelect" class="form-select">
                    <option value="">-- Select a file from database --</option>
                    {% for file in files %}
                    <option value="{{ file.id }}" data-rows="{{ file.rows_count }}" 
                            data-start="{{ file.date_range_start.strftime('%Y-%m-%d') if file.date_range_start else 'N/A' }}"
                            data-end="{{ file.date_range_end.strftime('%Y-%m-%d') if file.date_range_end else 'N/A' }}">
                        {{ file.original_filename }} (Uploaded: {{ file.uploaded_at.strftime('%Y-%m-%d %H:%M') }})
                    </option>
                    {% endfor %}
                </select>
                <div id="fileInfo" class="mt-2 text-muted"></div>
            </div>
        </div>
        
        <!-- Filter Options -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">3. Select Filters (Optional)</h5>
            </div>
            <div class="card-body">
                <!-- Month Filter -->
                <div class="mb-4">
                    <label class="form-label fw-bold">Months (leave empty for all months):</label>
                    <div class="row">
                        {% set months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'] %}
                        {% for month in months %}
                        <div class="col-md-2 col-sm-3 col-4 mb-2">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input month-check" 
                                       value="{{ loop.index }}" id="month{{ loop.index }}">
                                <label class="form-check-label" for="month{{ loop.index }}">{{ month }}</label>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Season Filter -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Seasons (leave empty for all seasons):</label>
                    <div class="row">
                        {% set seasons = [('DJF', 'Winter (Dec-Jan-Feb)'), ('MAM', 'Spring (Mar-Apr-May)'), 
                                         ('JJA', 'Summer (Jun-Jul-Aug)'), ('SON', 'Fall (Sep-Oct-Nov)')] %}
                        {% for season_code, season_name in seasons %}
                        <div class="col-md-3 col-sm-6 mb-2">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input season-check" 
                                       value="{{ season_code }}" id="season{{ season_code }}">
                                <label class="form-check-label" for="season{{ season_code }}">
                                    <strong>{{ season_code }}</strong> - {{ season_name }}
                                </label>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Plot Selection -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">4. Select Plot Types</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="form-check form-switch">
                        <input type="checkbox" id="generateAll" class="form-check-input">
                        <label class="form-check-label fw-bold" for="generateAll">
                            Generate All Plots (Rain + Snow)
                        </label>
                    </div>
                    <div class="form-text">Check this to generate all available plots for both rain and snow</div>
                </div>
                
                <div id="plotOptions">
                    <label class="form-label fw-bold">Select individual plots (applies to both rain and snow):</label>
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input plot-check" 
                                       value="monthly_heatmap" id="plot1">
                                <label class="form-check-label" for="plot1">Monthly Heatmap</label>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input plot-check" 
                                       value="monthly_climatology" id="plot2">
                                <label class="form-check-label" for="plot2">Monthly Climatology</label>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input plot-check" 
                                       value="monthly_distribution" id="plot5">
                                <label class="form-check-label" for="plot5">Monthly Distribution Boxplot</label>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input plot-check" 
                                       value="seasonal_boxplot" id="plot3">
                                <label class="form-check-label" for="plot3">Seasonal Boxplot</label>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input plot-check" 
                                       value="annual_totals" id="plot4">
                                <label class="form-check-label" for="plot4">Annual Totals</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Generate Button -->
        <div class="mb-4 text-center">
            <button onclick="generatePlots()" class="btn btn-success btn-lg px-5">
                <span id="generateSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                Generate Plots
            </button>
        </div>
        
        <!-- Results Section -->
        <div id="results" class="row"></div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>

